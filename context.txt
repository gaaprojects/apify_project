Implement the following plan:                                                                                                                                                                                                   
                                                                                                                                                                                                                                  
  # Czech Real Estate Price Analyzer - Implementation Plan                                                                                                                                                                        
                                                                                                                                                                                                                                  
  ## Overview                                                                                                                                                                                                                     
  Build a system that scrapes Czech real estate websites (sreality.cz, bezrealitky.cz), enriches with cadastral data (cuzk.gov.cz), predicts if prices are above/below/at market using ML, and displays results in a              
  map-focused frontend.                                                                                                                                                                                                           
                                                                                                                                                                                                                                  
  ## Tech Stack                                                                                                                                                                                                                   
  - **Scrapers**: Apify actors (TypeScript/Playwright)                                                                                                                                                                            
  - **Database**: PostgreSQL + PostGIS (Docker)                                                                                                                                                                                   
  - **Backend**: FastAPI (Python)                                                                                                                                                                                                 
  - **ML**: XGBoost/Random Forest (scikit-learn)                                                                                                                                                                                  
  - **Frontend**: Next.js 14 + Leaflet maps                                                                                                                                                                                       
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Project Structure                                                                                                                                                                                                            
                                                                                                                                                                                                                                  
  ```                                                                                                                                                                                                                             
  apify_project/                                                                                                                                                                                                                  
  ├── actors/                                                                                                                                                                                                                     
  │   ├── sreality-scraper/      # API-based scraper (30 req/min)                                                                                                                                                                 
  │   ├── bezrealitky-scraper/   # Playwright scraper (20 req/min)                                                                                                                                                                
  │   ├── cuzk-fetcher/          # Cadastral data enrichment                                                                                                                                                                      
  │   └── shared/                # Database utils, constants                                                                                                                                                                      
  ├── backend/                                                                                                                                                                                                                    
  │   ├── app/                                                                                                                                                                                                                    
  │   │   ├── api/v1/            # REST endpoints                                                                                                                                                                                 
  │   │   ├── models/            # SQLAlchemy models                                                                                                                                                                              
  │   │   ├── schemas/           # Pydantic schemas                                                                                                                                                                               
  │   │   ├── services/          # Business logic                                                                                                                                                                                 
  │   │   └── ml/                # Prediction service                                                                                                                                                                             
  │   └── alembic/               # Migrations                                                                                                                                                                                     
  ├── ml/                                                                                                                                                                                                                         
  │   ├── src/                   # Training pipeline                                                                                                                                                                              
  │   ├── models/                # Saved models                                                                                                                                                                                   
  │   └── notebooks/             # Analysis notebooks                                                                                                                                                                             
  ├── frontend/                                                                                                                                                                                                                   
  │   ├── src/app/               # Next.js pages                                                                                                                                                                                  
  │   ├── src/components/        # React components                                                                                                                                                                               
  │   └── src/lib/               # Utilities                                                                                                                                                                                      
  ├── database/init/             # SQL init scripts                                                                                                                                                                               
  └── docker-compose.yml                                                                                                                                                                                                          
  ```                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Database Schema (Key Tables)                                                                                                                                                                                                 
                                                                                                                                                                                                                                  
  ```sql                                                                                                                                                                                                                          
  -- Properties table with spatial support                                                                                                                                                                                        
  CREATE TABLE properties (                                                                                                                                                                                                       
  id SERIAL PRIMARY KEY,                                                                                                                                                                                                          
  external_id VARCHAR(100) NOT NULL,                                                                                                                                                                                              
  source VARCHAR(50) NOT NULL,  -- 'sreality', 'bezrealitky'                                                                                                                                                                      
                                                                                                                                                                                                                                  
  -- Basic                                                                                                                                                                                                                        
  title VARCHAR(500),                                                                                                                                                                                                             
  property_type VARCHAR(50),    -- 'apartment', 'house'                                                                                                                                                                           
  transaction_type VARCHAR(50), -- 'sale', 'rent'                                                                                                                                                                                 
  price DECIMAL(15, 2),                                                                                                                                                                                                           
                                                                                                                                                                                                                                  
  -- Size                                                                                                                                                                                                                         
  area_usable DECIMAL(10, 2),                                                                                                                                                                                                     
  rooms VARCHAR(20),            -- '2+kk', '3+1'                                                                                                                                                                                  
  floor INTEGER,                                                                                                                                                                                                                  
                                                                                                                                                                                                                                  
  -- Features                                                                                                                                                                                                                     
  condition VARCHAR(50),                                                                                                                                                                                                          
  energy_rating VARCHAR(10),                                                                                                                                                                                                      
  has_balcony BOOLEAN,                                                                                                                                                                                                            
  has_parking BOOLEAN,                                                                                                                                                                                                            
  has_elevator BOOLEAN,                                                                                                                                                                                                           
                                                                                                                                                                                                                                  
  -- Location                                                                                                                                                                                                                     
  address_city VARCHAR(255),                                                                                                                                                                                                      
  coordinates GEOMETRY(POINT, 4326),                                                                                                                                                                                              
                                                                                                                                                                                                                                  
  -- ML predictions                                                                                                                                                                                                               
  predicted_price DECIMAL(15, 2),                                                                                                                                                                                                 
  price_assessment VARCHAR(20), -- 'below_market', 'at_market', 'above_market'                                                                                                                                                    
  price_deviation_percent DECIMAL(5, 2),                                                                                                                                                                                          
                                                                                                                                                                                                                                  
  -- Cadastral                                                                                                                                                                                                                    
  cadastral_number VARCHAR(50),                                                                                                                                                                                                   
  liens_count INTEGER DEFAULT 0,                                                                                                                                                                                                  
                                                                                                                                                                                                                                  
  UNIQUE(external_id, source)                                                                                                                                                                                                     
  );                                                                                                                                                                                                                              
                                                                                                                                                                                                                                  
  CREATE INDEX idx_properties_coordinates ON properties USING GIST(coordinates);                                                                                                                                                  
  ```                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Scraping Strategy                                                                                                                                                                                                            
                                                                                                                                                                                                                                  
  ### sreality.cz                                                                                                                                                                                                                 
  - **Method**: Public API at `https://www.sreality.cz/api/cs/v2/estates`                                                                                                                                                         
  - **Rate limit**: 30 requests/minute                                                                                                                                                                                            
  - **Data**: price, area, rooms, floor, condition, energy rating, GPS, photos                                                                                                                                                    
                                                                                                                                                                                                                                  
  ### bezrealitky.cz                                                                                                                                                                                                              
  - **Method**: Playwright (JavaScript rendering) + __NEXT_DATA__ extraction                                                                                                                                                      
  - **Rate limit**: 20 requests/minute                                                                                                                                                                                            
  - **Data**: price, area, rooms, condition, amenities, GPS                                                                                                                                                                       
                                                                                                                                                                                                                                  
  ### cuzk.gov.cz (Cadastral)                                                                                                                                                                                                     
  - **Method**: Free INSPIRE WFS services (no registration)                                                                                                                                                                       
  - **Endpoint**: `https://services.cuzk.cz/wfs/inspire-cp-wfs.asp`                                                                                                                                                               
  - **Data**: parcel info, ownership type, liens/encumbrances, historical prices                                                                                                                                                  
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## ML Pipeline                                                                                                                                                                                                                  
                                                                                                                                                                                                                                  
  ### Features (Extended Set)                                                                                                                                                                                                     
  - **Numerical**: area_usable, rooms_count, floor, floors_total, distance_to_center                                                                                                                                              
  - **Categorical**: property_type, condition, construction_type, energy_rating, city                                                                                                                                             
  - **Boolean**: has_balcony, has_terrace, has_parking, has_elevator, has_cellar                                                                                                                                                  
                                                                                                                                                                                                                                  
  ### Model                                                                                                                                                                                                                       
  - Primary: XGBoost Regressor                                                                                                                                                                                                    
  - Target: log(price) for better distribution                                                                                                                                                                                    
  - Assessment thresholds: ±10% from prediction                                                                                                                                                                                   
                                                                                                                                                                                                                                  
  ### Price Assessment                                                                                                                                                                                                            
  - `below_market`: actual price < predicted - 10%                                                                                                                                                                                
  - `at_market`: within ±10% of predicted                                                                                                                                                                                         
  - `above_market`: actual price > predicted + 10%                                                                                                                                                                                
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## API Endpoints                                                                                                                                                                                                                
                                                                                                                                                                                                                                  
  ```                                                                                                                                                                                                                             
  GET  /api/v1/properties              # List with filters                                                                                                                                                                        
  GET  /api/v1/properties/{id}         # Detail                                                                                                                                                                                   
  GET  /api/v1/properties/map          # Properties in bounds                                                                                                                                                                     
  GET  /api/v1/properties/{id}/similar # Similar properties                                                                                                                                                                       
                                                                                                                                                                                                                                  
  POST /api/v1/predictions/predict     # Single prediction                                                                                                                                                                        
  POST /api/v1/predictions/batch       # Batch predictions                                                                                                                                                                        
                                                                                                                                                                                                                                  
  GET  /api/v1/analytics/price-trends  # Price over time                                                                                                                                                                          
  GET  /api/v1/analytics/market-overview                                                                                                                                                                                          
  GET  /api/v1/analytics/heatmap       # Price heatmap data                                                                                                                                                                       
  ```                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Frontend Pages                                                                                                                                                                                                               
                                                                                                                                                                                                                                  
  1. **Dashboard** (`/`) - Market overview, quick stats                                                                                                                                                                           
  2. **Properties** (`/properties`) - Filterable list with cards                                                                                                                                                                  
  3. **Property Detail** (`/properties/[id]`) - Full details + similar                                                                                                                                                            
  4. **Map View** (`/map`) - Clustered markers, color by assessment                                                                                                                                                               
  5. **Analytics** (`/analytics`) - Charts and trends                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ### Key Components                                                                                                                                                                                                              
  - `PropertyCard` - Card with image, price, PriceIndicator badge                                                                                                                                                                 
  - `PriceIndicator` - Green/Yellow/Red badge for assessment                                                                                                                                                                      
  - `PropertyMap` - Leaflet + MarkerCluster                                                                                                                                                                                       
  - `PriceTrendChart` - Line chart with Chart.js                                                                                                                                                                                  
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Implementation Phases                                                                                                                                                                                                        
                                                                                                                                                                                                                                  
  ### Phase 1: Foundation                                                                                                                                                                                                         
  1. Create project structure                                                                                                                                                                                                     
  2. Set up PostgreSQL + PostGIS in Docker                                                                                                                                                                                        
  3. Create database schema                                                                                                                                                                                                       
  4. Initialize FastAPI skeleton                                                                                                                                                                                                  
                                                                                                                                                                                                                                  
  ### Phase 2: Data Collection                                                                                                                                                                                                    
  5. Build sreality-scraper actor (API-based)                                                                                                                                                                                     
  6. Build bezrealitky-scraper actor (Playwright)                                                                                                                                                                                 
  7. Build cuzk-fetcher actor (WFS enrichment)                                                                                                                                                                                    
  8. Test with 100 properties per source                                                                                                                                                                                          
                                                                                                                                                                                                                                  
  ### Phase 3: Backend API                                                                                                                                                                                                        
  9. Implement property CRUD + filters                                                                                                                                                                                            
  10. Add spatial queries for map                                                                                                                                                                                                 
  11. Add analytics endpoints                                                                                                                                                                                                     
  12. Write integration tests                                                                                                                                                                                                     
                                                                                                                                                                                                                                  
  ### Phase 4: ML Pipeline                                                                                                                                                                                                        
  13. Implement feature engineering                                                                                                                                                                                               
  14. Train and evaluate models                                                                                                                                                                                                   
  15. Integrate predictor with API                                                                                                                                                                                                
  16. Run batch predictions on all properties                                                                                                                                                                                     
                                                                                                                                                                                                                                  
  ### Phase 5: Frontend                                                                                                                                                                                                           
  17. Set up Next.js + Tailwind + shadcn/ui                                                                                                                                                                                       
  18. Build property list and detail pages                                                                                                                                                                                        
  19. Integrate Leaflet map with clustering                                                                                                                                                                                       
  20. Build analytics dashboard with charts                                                                                                                                                                                       
                                                                                                                                                                                                                                  
  ### Phase 6: Integration                                                                                                                                                                                                        
  21. End-to-end testing                                                                                                                                                                                                          
  22. Performance optimization (Redis caching)                                                                                                                                                                                    
  23. Docker Compose for full stack                                                                                                                                                                                               
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Verification Checklist                                                                                                                                                                                                       
                                                                                                                                                                                                                                  
  - [ ] Database accepts spatial queries (`ST_DWithin`)                                                                                                                                                                           
  - [ ] Scrapers fetch 100+ properties successfully                                                                                                                                                                               
  - [ ] API returns filtered properties with pagination                                                                                                                                                                           
  - [ ] ML model achieves R² > 0.7 on test set                                                                                                                                                                                    
  - [ ] Map displays clustered markers with colors                                                                                                                                                                                
  - [ ] Price assessment badges show correctly                                                                                                                                                                                    
  - [ ] Analytics charts render with real data                                                                                                                                                                                    
  - [ ] Full stack runs in Docker Compose                                                                                                                                                                                         
                                                                                                                                                                                                                                  
  ---                                                                                                                                                                                                                             
                                                                                                                                                                                                                                  
  ## Cities to Cover                                                                                                                                                                                                              
  - Praha (Prague)                                                                                                                                                                                                                
  - Brno                                                                                                                                                                                                                          
  - Ostrava                                                                                                                                                                                                                       
  - Plzen                                                                                                                                                                                                                         
                                                                                                                                                                                                                                  
  ## Property Types                                                                                                                                                                                                               
  - Apartments (byty)                                                                                                                                                                                                             
  - Houses (domy)                                                                                                                                                                                                                 
                                                                 